<div class='row height-40'>
  <span class='col-sm-1 top-pad'><%= link_to image_tag('back.jpg'), category_path(@business.category) %></span>
  <div id='business-tag'>
    <% #FIXME_AB: Should not use size attribute, it will distort the image. Create and use proper size of thumbnails -%>
    <%= image_tag @business.category.image.url(:thumb), size: '80x30' %>
    <% #FIXME_AB: code for displaying name is being repeated. Ideally it should go in presenter. Since we haven't learnt the concept of presenter, we should move it to model as Category#display_name for now. Similarly for business name -%>
    <div id= 'business-name'><%= @business.category.name.humanize %></div>
  </div>
</div>

<div class='container col-sm-10 col-sm-offset-1 top-pad-50'>
  <div class='row top-pad'>
      <span class='h1'>
        <%= @business.name.humanize %>
      </span>
  </div>

  <div class='jumbotron'>
    <div class='row'>
      <div class='col-sm-5'>
        <div id="carousel" class="carousel slide" data-ride="carousel">
          <% if @business.year_of_establishment %>
            <div id='establishment'>
              <p class='rotate'>Since <%= @business.year_of_establishment %></p>
            </div>
          <% end %>
          <div class="carousel-inner">
            <% #FIXME_AB: Since we have egarloaded images, use .present. .exists? fires an extra query to check images. Similarly for other places -%>
            <% if @business.images.present? %>
              <% @business.images.each_with_index do |img, i| %>
                <div class="item <%= active_class(i) %>">
                  <%= image_tag img.image.url, id: 'cimg' %>
                </div>
              <% end %>
            <% else %>
              <div class="item active">
                <%= image_tag 'missing.png', id: 'cimg' %>
              </div>
            <% end %>
          </div>
          <a class="left carousel-control" href="#carousel" role="button" data-slide="prev">
            <div class="arrow" aria-hidden="true"><p><</p></div>
          </a>
          <a class="right carousel-control" href="#carousel" role="button" data-slide="next">
            <div class="arrow" aria-hidden="true"><p>></p></div>
          </a>
        </div>
      </div>
      <div class='col-sm-7'>
        <div class='table'>
          <div class='row top-pad'>
            <span class='col-sm-2'><%= image_tag 'home1.png' %></span>
            <span class='col-sm-10 text-height-20'><%= @business.address_sentence %></span>
          </div>
          <% if @business.address.area.present? %>
            <div class='row top-pad'>
              <span class='col-sm-2'>
                <% #FIXME_AB: Make a helper for this. -%>
                <%=link_to image_tag('marker1.jpg'), google_map_url(@business), :target => "_blank" %></span>
              <span class='col-sm-10 text-height-20'>
                  <%= @business.address.area %>
              </span>
            </div>
          <% end %>
          <% if @business.phone_numbers.exists? %>
            <div class='row top-pad'>
              <span class='col-sm-2'><%= image_tag 'phone.jpg' %></span>
              <span class='col-sm-10 text-height-20'><%= @business.phone_numbers_sentence %></span>
            </div>
          <% end %>
          <div class='row top-pad'>
            <div class='row'>
              <span class='col-sm-4  col-sm-offset-1 text-height-23'>Rating</span>
            </div>
            <div class='col-sm-4 col-sm-offset-1 text text-height-20'>★★★★★</div></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <% if @business.time_slots.exists? %>
  <div>
  <%= image_tag 'bullet.jpg', class: 'sliders' %><span class='text-height-20 sliders'>Working Hours</span>
  <div class='jumbotron table expandable'>
    <% @business.time_slots.each do |time_slot| %>
      <div class='row'>
        <div class='col-sm-5 text-height-20'>
          <%= time_slot.week_days %>
        </div>
        <div class='col-sm-6 text-height-20'>
          <% #FIXME_AB: Don't repeat time format use http://api.rubyonrails.org/classes/DateTime.html#method-i-to_formatted_s -%>
          <%= time_slot.from.to_formatted_s(:timmings) %> TO <%= time_slot.to.to_formatted_s(:timmings) %>
        </div>
      </div>
    <% end %>
  </div>
  </div>
<% end %>

  <% if @business.description.present? %>
    <div>
      <%= image_tag 'bullet.jpg', class: 'sliders' %><span class='text-height-20 sliders'>Description</span>
      <div class='jumbotron text-height-20 expandable'>
        <%= @business.description %>
      </div>
    </div>
  <% end %>

  <% if @business.website.present? && @business.emails.exists? %>
    <div>
    <%= image_tag 'bullet.jpg', class: 'sliders' %><span class='text-height-20 sliders'>Online Presence</span>
    <div class='jumbotron expandable'>
      <div class='row'>
        <% if @business.website.present? %>
          <div class='col-sm-1'>
            <%= image_tag 'website.jpg' %>
          </div>
          <div class='col-sm-10 text-height-20'>
            <%= link_to @business.website.info, url_with_protocol(@business.website.info), target: '_blank' %>
          </div>
        <% end %>
      </div>
      <div class='row top-pad'>
        <% if @business.emails.exists? %>
          <div class='col-sm-1'>
            <%= image_tag 'email.jpg' %>
          </div>
          <div class='col-sm-10 text-height-20'>
            <%= @business.emails_sentence %>
          </div>
        <% end %>
      </div>
    </div>
    </div>
  <% end %>

  <%= image_tag 'bullet.jpg' %><span class='text-height-20'>Rate & Review </span>
  <div class='jumbotron'>
  </div>

</div>

<% content_for :head do javascript_include_tag :user_businesses end %>
